---
import Layout from "../layouts/Layout.astro";
import Card from "../components/Card.astro";
import Modal from "../components/modal/modal";
import Heading from "../components/heading/heading";
import Button from "../components/button/button";
import { Image } from "astro:assets";

export const prerender = false;

const response = await fetch(
  "https://hallinta.kriteeripankki.fi/fi/jsonapi/node/criterion",
);
const { data } = await response.json();

if (Astro.request.method === "POST") {
  // Parse form data
  const formData = await Astro.request.formData();
  const authori = formData.get("author");
  const content = formData.get("content");
  console.log(authori, content);
}
---

<Layout title="Front page">
  <main>
    <Heading level="h1" size="xl">Welcome to Astro</Heading>

    {
      Astro.request.method === "POST" && (
        <div class="bg-green-200 p-4 my-4">
          <p>Comment added successfully!</p>
        </div>
      )
    }

    <div class="my-6">
      <Modal id="test" client:load> Opened </Modal>
    </div>

    <div class="p-6 bg-slate-200 my-10">
      <form method="POST" class="max-w-[640px]">
        <div class="my-10">
          <label for="author" class="block">Author</label>
          <input id="author" name="author" class="w-full" required />
        </div>
        <div class="my-10">
          <label for="content" class="block">Content</label>
          <textarea
            id="content"
            name="content"
            class="w-full"
            required
            minlength="6"></textarea>
        </div>
        <div class="my-10">
          <Button style="primary" type="submit">Submit</Button>
        </div>
      </form>
    </div>

    {
      data.map((item: any) => (
        <div class="mb-10">
          <a
            href={item.attributes.drupal_internal__nid}
            class="underline text-xl font-bold"
          >
            {item.attributes.title}
          </a>

          <Image
            src={`https://picsum.photos/id/${item.attributes.drupal_internal__nid}/600/600`}
            alt="random"
            width={300}
            height={300}
            transition:name={`img-${item.attributes.drupal_internal__nid}`}
          />
          <p>{item.attributes.field_reasoning}</p>
        </div>
      ))
    }

    <ul role="list" class="link-card-grid">
      <Card
        href="https://docs.astro.build/"
        title="Documentation"
        body="Learn how Astro works and explore the official API docs."
      />
      <Card
        href="https://astro.build/integrations/"
        title="Integrations"
        body="Supercharge your project with new frameworks and libraries."
      />
      <Card
        href="https://astro.build/themes/"
        title="Themes"
        body="Explore a galaxy of community-built starter themes."
      />
      <Card
        href="https://astro.build/chat/"
        title="Community"
        body="Come say hi to our amazing Discord community. ❤️"
      />
    </ul>
  </main>
</Layout>
